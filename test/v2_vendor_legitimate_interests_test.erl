-module(v2_vendor_legitimate_interests_test).
-include("consent_string.hrl").
-include_lib("eunit/include/eunit.hrl").

consent_string_range_with_legitimate_interests_test() ->
    TCFv2Legitimate = <<"CO4Hcm2O4Hcm2AKAJAFRAzCsAP_AAH_AAAqIGVtd_X9fb2vj-_5999t0eY1f9_63t-wzjgeNs-8NyZ_X_J4Xr2MyvB34pqYKmR4EunLBAQdlHGHcTQgAwIkVqTLsYk2MizNKJ7JEilMbM2dYGG1Pn8XTuZCY70-sf__zv3-_-___6oGUEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7I4CPUACABAYgIQIgQYgohZBAAIAAElEQAgAwIBEARAIAAQAjQEIACJAEFgBIGAQACoGhYARRBKBIQYHBUcogQFSLRQTzAAAAA.f_gAAAAAAAAA">>,
    {ok, Actual} = consent_string:parse_b64(TCFv2Legitimate),

    #consent {
       vendor_legitimate_interests = #vendor_legitimate_interests {
           max_vendor_id = MaxVendorId,
           interests = #entry_bitfield {
               fields = Bitfield
           }
       }
    } = Actual,

    Expected = <<65,38,26,151,192,64,144,150,48,18,77,154,85,10,32,66,21,196,
                 133,64,56,0,162,132,97,104,210,195,66,71,5,59,35,128,143,80,
                 0,128,4,6,32,33,2,32,65,136,40,133,144,64,0,128,0,18,81,16,
                 2,0,48,32,17,0,68,2,0,1,0,35,64,66,0,8,144,4,22,0,72,24,4,0,
                 10,129,161,96,4,81,4,160,72,65,129,193,81,202,32,64,84,139,
                 69,4,243>>,

    ?assertEqual(808, MaxVendorId),
    ?assertEqual(Expected, Bitfield).

consent_string_with_vendor_legitimate_interests_range_test() ->
    TCF = <<"CO4xF7sO4xF8KAHABBENA0CsAP_AAH_AAAAAGSQKQABQAKAAyAB4AIAAVgAuADIAHAAQAAkgBSAFQALQAXgAyABoADwAIsARwBIACYAE-ALQAtgBtAD0AIQATYAnQBcgDSAHOAO6AfoB_AEIAJ0AVkAzQBnQDTgG_AUkAr4BeYDGQGSAZJAaAAEAAsAB4AFQALgAZAA4ACAAFQANAAeABMACeAF0ANoAegBCAC5AGkAOcAdwA_QCEAHkAXmAyQAA.f_gAD_gAAAAA">>,
    {ok, Actual} = consent_string:parse_b64(TCF),

    #consent {
       vendor_legitimate_interests = #vendor_legitimate_interests {
           max_vendor_id = MaxVendorId,
           interests = #entry_range {
               num_entries = NumEntries,
               entries = Entries
           }
       }
    } = Actual,

    ExpectedLegitimateEntries =
        [804,755,484,264,253,238,231,210,185,132,
         122,109,93,79,76,60,52,42,32,28,25,23,21,
         15,11,2],

    ?assertEqual(26, NumEntries),
    ?assertEqual(804, MaxVendorId),
    ?assertEqual(Entries, ExpectedLegitimateEntries).

consent_string_legitimate_interests_lookup_test() ->
    TCF = <<"CO4xF7sO4xF8KAHABBENA0CsAP_AAH_AAAAAGSQKQABQAKAAyAB4AIAAVgAuADIAHAAQAAkgBSAFQALQAXgAyABoADwAIsARwBIACYAE-ALQAtgBtAD0AIQATYAnQBcgDSAHOAO6AfoB_AEIAJ0AVkAzQBnQDTgG_AUkAr4BeYDGQGSAZJAaAAEAAsAB4AFQALgAZAA4ACAAFQANAAeABMACeAF0ANoAegBCAC5AGkAOcAdwA_QCEAHkAXmAyQAA.f_gAD_gAAAAA">>,
    {ok, Consent} = consent_string:parse_b64(TCF),

    ?assertEqual(false, consent_string_v2:vendor_legitimate_interests([1], Consent)),
    ?assertEqual(true, consent_string_v2:vendor_legitimate_interests([2], Consent)),
    ?assertEqual(false, consent_string_v2:vendor_legitimate_interests([1,2,3,4,5], Consent)),
    ?assertEqual(true, consent_string_v2:vendor_legitimate_interests([2,11,15,21,23], Consent)),
    ?assertEqual(true, consent_string_v2:vendor_legitimate_interests([804], Consent)),
    ?assertEqual(false, consent_string_v2:vendor_legitimate_interests([805], Consent)).

consent_string_legitimate_interests_bad_encoding_test() ->
    %% these have been observed in the wild, and may be good to keep
    %% around to test for robustness. At this point it might be even a
    %% good idea to fuzz some of this.
    InvalidTCFEncoding = [
            <<"CO5deWWO5deWWAGABCENA2CsAP_AAH_AAAwIGVtf_X9fb2_j-_5999t0eY1f9_63t-wzjgeNs-8NyZ_X_J4Xr2MyvB34pqYKuR4EunLBAQdlHGHcTQgAwIkVqTLsYk2MqzNKJ7JEilMbM2dYGG1vn8XT_ZCY70-_f__7v3-_-___6oGUEEGAAKAAACCAAAEihEIAAIAxIAAAAAihEAoEkACRQADI4COQAAABAYgIQAAQAgIAYB">>
            , <<"CO5d6YuO5d6YuAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZBAAAAAElEQAkBwIBEAR">>
            , <<"CO5lMpBO5lMpBAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZ">>
            , <<"CO5azl_O5azl_AGABCENA2CsAP_AAH_AAAYgGTpR_TpVbWFCyXZ9dtsAKIgXVASWA-QCAASAI2ABgAKQMBwCgmAQtASgBgACAQAAoBJBAAIEDAAESQAAwAAAAACAAAAEgAAIIAAAgBEAAAAYAAgKAIAABACIgAAQEAAAi0AIAiZgCBgkCKABwAHgAqABoADkAH4ATwArABZAC6AF8ANoAhABYgDUAH7AQcBCACIgEWAI4AWIAuYBdYDAAMCAYoAzIBrwDeAHUARAAlYBRICuwF9AMEANGQCQAVABMAC4AKQAagA4gDeAKbAXmIgGgAqACsAFwAQwApABqADiAQ2Ai8BOwChwFIgMnEgAQAHBIE4ACwAKgAZAA4AB4AEAAIgAVAA8ACIAEyAKoArABYAC4">>
            , <<"CO5GbLCO5GbLCAGABCENA1CsAP_AAH_AABAgF5wJQAAgAIgAUABoAEgAKwAXABgADgAHgAQAAqABaADIAGkAPQA-gCIAIoATIAnACgAFkALcAXgBfgDCAMQAZQA2wCAAIEAQgAjgBOwCkAKUAZwBGACOgGaANsAf8BVwCzAF5gP_AMAAQACoAHwATwAsgBfADaAIQARwAnQCLAH_AKGQBgAVABMAEcAKQAjAC8xEAMAFQApACMBI">>
            , <<"CO5lSG5O5lSG5AKAMAELA3CsAP_AAH_AAAyIGkNd_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8Nyd_X_L4Xr2MyvB36pq4KuR4Eu3LBAQFlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGHtPn9XTuZCY70_sf__z_3-_-___67f-L2wMkIJMFS-AgSEsYCSb">>
            , <<"CO5d-avO5d-avAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZBAAAAAElEQAkBwIBEARAIAAQArQEIACJAEFgBIGAQACgGhYARRBK">>
            , <<"CO5lN7jO5lN7jAcABBENA3CsAP_AAH_AAChQGkNf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8Nyd_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn9XTuZCY70_sf__z_3-_-___67f-L2wNJIJMNS-AgSEsYCSbNKoUQIQriQqAcAFFCMLRpYaErgp2VwEeoIEACA1ARgRAgxBRiyCAAAAAJKIgBIDgQCIAiAQAAgBWgIQAESAILACQMAgAFANCw">>
            , <<"CO5e2TRO5e2TRAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZBAAAAAElEQAkBwIBEARAIAAQArQEIACJAEFgBIGAQACgGhYARRBKBIQZHBUcogQFSLRQTTRgSQCBQI8AA4ACQAGgAPAApABgAGYAQgBE">>
            , <<"CO4QMvAO4QMvAAKAJAELAzCsAP_AAH_AAAyIGVtd_X9fb2vj-_5999t0eY1f9_63t-wzjgeNs-8NyZ_X_J4Xr2MyvB34pqYKmR4EunLBAQdlHGHcTQgAwIkVqTLsYk2MizNKJ7JEilMbM2dYGG1Pn">>
            , <<"CO5a72-O5a72-AGABCENA2CgAP_AAAVAAAYgGMgR5CoUTGFAUXB4QtkAGYQQUAQEAWAAAACAAiABAAEAMAAAAUAAoASAAAACAAAAIAIBAAAACAAEAQAAQAAEAAAAAAAAgAAIIABEAAAAAAAAAAgAAAAAAAAAAAEBAAAAkAAAAmIFtQAwA5AJOAW0AeMgDABMAC4AKQAcQBHAF5iIBAAXABDACkAHEAhsBF4CRAFDhIDoACwAKgAZAA8ACAAGgAPAAfABEACYAFwAN4AcwBCACGAFKAMMAcQA_QCNAEcAMUAbgA9ACGwEXgJEAUOAvMIACACeAokN">>
            , <<"CO450n6O450n6AGABCENA1CsAP_AAH_AAAYgGVtf_X9fb2_je_5999t0eY1f9_63t-wzjgeNs-8NyZ_X_J4Xr2MyvB34pqYKmR4EOnLBAQdlHGHcTQgAwIkFqTLMYk2MizNKJ7JEilIbc2dYG">>
            , <<"CO5iji_O5iji_AHABBENA2CsAP_AAH_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZBAAAAAElEQAkBw">>
            , <<"CO5dhnPO5dhnPAKAIAENA2CsAP_AAH_AAAwIGetd_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQFlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGHtPn8X">>
            , <<"CO5lNpEO5lNpEAHABBENA2CsAP_AAH_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu1LBAQdkHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZBAAAAAElEQAkBwI">>
            , <<"CO4DtH8O4DtIfB7ACBITAyCsAP_AAAAAAAAAGStX_T9fb2vj-_5999t0eY1f9_63t-wjhgeMs-8NyZ-X_J4Wr2MyvB34JqQKGRgEunLBAQdlHGHcTQgAwIkViTLMYk2MizNKJrJEilMbc2dYGG1vn8XTuZCY70-sP__zv3-_-33_4GSEEmCpfAQJCWMBJNmlUKIEIVxIVAOASghGEg0sNCRwU7I4CPUACABAYAIQIAQAgohJBAAIAAElEQAgAwIBEARAIAAQAjQEIACJAEFgBIGAQACoGhYARRBKBIQYHBUcogQFSLRQTwCgUKwAAgACYAGAAbAA8AEAALAAYAA0AB8AEMAJAAlABSAC8AGYANYAcgB0AD0AH4ARQAkABOgCyALUAXQBfADDAGQAZQA0ABsADcAHIAPkAfgCDAEKAIqARgBGwCPAJEATcAnQCegFAAUUApwCoAFmALkAX0AwADCAGPAM0AzgBpwDXANgAbQA6gB3ADwAHmAPqAfwCAQEGAQcAhIBDoCIAIiAROAioCLgEZAI7ASEBIgCSwEvATCAmwCbwE7AT8AosBSAFJALMAW0AuABdQC7wF8AX0AwIBgwDJQGZAZoAzsBnwGgANFAaYBpwDWgGvgNkA2YBtwDfgHCAOkAdsA74B5ADzAHrAPfAfUB9gD8wH_AgCBAgECgIJAQZAg8CEAEJwIXAhiBD4EQwIlAiYBFICLAEYgI1gRwBHMCPQI-gScBJ4CVIErASuAlkBL4CYQEyQJmAmeBNIE1AJtgTgBOQCdAE7wJ-An-BQoFDQKIAoqBRgFGwKPApABSYClgFMAKcAVBAqICpIFVAVXAq0CroFZAVmArkBXYCv4FhAWHAscCyAFlALMgWeBaEC0gLTAWqAtcBbcC3QLfAXCAuOBcoFzwLpAuoBesC9wL6gX4BfsC_wMBgYGBgoDB4GFAYYAw6BiAGIwMUAxUBi8DGgMbAY-AyEBkYDJQkL2AAIABAAEAANAAkACoAGAAbAA8AEAAJQAWABgADQAHwAQwAkACWAE4AUwAsAC0AF8AMgAzABrADkAOwAegA_ACFAEUASQAnABQgCkAKcAWQBbgC6AL8AYQBigDIAMoAaAA2ABuADkAHyAPwBBgCFgEUARsAjwCRAEqAJuAToBPQCgAKKAU4BUACtAFnALgAuQBfQDAAMIAY8AzQDOAGiANMAasA1wDYAG0AOCAcYByQDqAOsAdwA8IB5AHnAPkA-oB_AIBAQYBCQCHQEQAREAicBFQEXAIyAR2AkICRQElASYAlcBLwEwgJsAm8BOgE_AKLAUgBSQCoAFZgK8Ar4BZgC2gFwgLqAu8BfAF9AMCAYMAyUBmAGagM4AzsBnwGgANFAaYBpwDWgGvgNkA2cBtgG3gN-A4ABwgDjgHSAO2Ad8A8QB5ADzQHqAesA98B9QH2APyAfuA_4EAQIEAgUBBICDIEHgQhAhICE4ELgQxAh8CIYESgRMAikBFgCMQEawI4AjkBHcCPQI-ASCAkuBJwEngJRASp">>
            , <<"CO5B9bvO5B9bvAKAHAPLA1CsAP_AAH_AAAwIGatd_X9fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KmR4Eu3LBAQFlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGG9Pn8XTuZCY70_sf__z_3-_-___67bgZQQSYal8BAkJYwEk2aVQogQhXEhUA4AKKEYWjSw0JHBTsjgI9QAIAEBiAhAiBBiCiFkEAAAAASURACADAgEQBEAgABACNAQgAIkAQWAEgYBAAKAaFgBFEEoEhBgcFRyiBAVItFBPM">>
            , <<"CO5lN7TO5lN7TAGABCENA3CsAP_AAH_">>
            , <<"CO5jY4tO5jY4tAcABBENA3CsAP_AAH_AACiQGkJT_T7VbWFCyf59dtsAOIhXVsSWA-QCAASAI2ABgAKQMBwCgmAQtASgBgAAIAAAoDJBAAIEDAAESQAAwAAAAACAAAAEgAAIIAKAgBEAAAAYAAoCAIAAAACIgAAAEAAAv3-oAPZoCyEAD2wNJABMFSqAgCEkYCSbNIAUQAArAAoAcAEAAEARoACA">>
            , <<"CO5lOAtO5lOBMBMBpBESA3CsAP_AAH_AAAiQGktd_X_fb2vj-_599_t0eY1f9_63v-wzjgeNs-8Nyd_X_L4Xv2MyvB36pq4KuR4ku3bBAQFtHOncTQmRwIlVqTLsbk2Mr7NKJ7LEilsbe2dYGHtPn9XT-ZKZ70_sf__7_3______77">>
            , <<"CO4DEJ_O4DEJ_CGABBENAxCsAP_AAH_AAAAAGPtX_T9fb2vj-_Z99_tkeY1f97y3t-wzhheMs-8NyZeX_B4Wv2MyvBX4JiQKGRgkunL">>
            , <<"CO5egnaO5egnaAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQYgoxZBAAAAAElEQAkBwIBEARAIAAQArQEIACJAEFgBIGAQACgGhYARRBKBIQZHBUcogQFSLRQTTRgSQCBQI8AA4ACQAGgAPAApABgAGYAQgBEACWAFIAVAAsABiADWAHwAfwBCAEMAJgAWgAuQBeAF8AMQAZgA2gB4AD1AH8AggBCgCKgEaARwAkwBKgCZgE8AUAAqABWgCygFuAXEAygDLgGaAZ0A0wDVAGwANoAcEA4gDkgHeAeEA8wD0gHyAfQA_AB_wEFAQYAhIBEACMAEcgJKAkwBK4CWgJcATAAm8BPAE-AKCAUgApYBUYCugK-AWaAtAC0gFzgLqAu4BfAC_AGEAMVAZwBnQDQAGnANaAbQA3gBwgDnAHbAO-AeIA9YB7QD9gH_AQIAgcBBgCEgELgIfARKAiwBHECOgI7ASCAkMBKICVIEvAS_AmECYgEzQJsAm0BO4CfwFCgKIAUZAo8CkAFMwKbApwBUQCpIFWgVeArMBW0CxALFgWOBZICzAFogLVgWuBbAC3AFwQLkAucBdcC7QLugXoBesC9wL6AYEAwqBhoGHwMUAxUBjUDHgMgAZEAyUBlcDMAMxAZpAzgDOYGeAZ6KgBABhAMCLAAgI9EQxwAAgAEgAMAA4ACYAFgAgABIACkAFgAYgA0ADYAH4AQgBFACQAJYATgBSACwAF4AMwAawA5ADqAHgAfwBBAEKAIgAkgBMgCcAKEAWABbgC6AL8AYQBigDIAMoAaAA2QBuAG-AOQA5gB3AD5AH4AgwBCwCJAIqARgBGwCPAJEATcAnQCiAFLAKcAqIBWgFcALMAXIAvoBgAGEAMeAZoBnADTAGrANcA2ABtADggHGAcgA54B1AHWAO4AeEA8gD0gHyAfQA_gCAQEGAQcAhIBDoCIAImARUAi4BGQCOgEhgJKAkwBKwCWwEvATCAmwCbwE6AT8AosBSAFJgKgAqIBWYCugK-AWYAtoBcIC6gLuAXqAvgC_QGAAYEAwYBkgDNQGcAZ2Az4DQAGigNMA1ABqwDWgGvgNkA2cBtgG3gN-A4ABwgDjwHKAcsA5wB0gDtgHfAPEAeQA80B6gHrAPfAfUB9gD8gH7gP-BAECBAIFgQOBBICDIEHgQhAhICE4ELgQxAh8CIQERwIlAiYBFICLAEYgI1gRwBHcCPQI-ASCAkMBJcCTgJPASjAlYCV4EsgS1Al4CXwEwgJkgTMBM8CaQJqATbAnACcgE6AJ3gT8BP8ChQKGAUQAoqBRgFGgKQgUkBSYClgFMQKbApwBUECogKkgVUBVcCrQKugVkBWYCuQFdgK_gWEBYsCxwLIAWUAsyBZ4FqgLXgW2Bb8C4QLjgXKBdgC7gF4wL0AvWBe4F9QL8Av2Bf4GAwMDAwUBg8DCgMMAYdAxADEoGKAYvAxkDG4GPAY_AyEDJYGUAZSAyuBl4GYgMzAZsAzgBnowEcAAcABIADwAKQAYABmAEIARQApA">>
            , <<"CO5h3spO5h3spAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo">>
            , <<"CO5KpiGO5KpiGAHABBENA2CsAP_AAH_AAAAAGatf_X9fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KmR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGG9vn8XTuZCY70_sf__z_3-_-___67bgZeQSYal8BAkJYwEk2aVQogQhXEhUA4AKKEYWjSw0JHBTsrgI9QQIAEBqAjAiBBiCjFkEAAAAASURACQDAgEQBEAgABACt">>
            , <<"CO4C4XYO4C4XYAcABBENA3CsAP_AAH_AACiQGStX_T9fb2vj-_5999t0eY1f9_63t-wjhgeMs-8NyZ-X_J4Wr2MyvB34JqQKGRgEunLBAQdlHGHcTQgAwIkViTLMYk2MizNKJrJEilMbc2dYGG1vn8XTuZCY70-sP__zv3-_-33_4GSEEmCpfAQJCWMBJNmlUKIEIVxIVAOASghGEg0sNCRwU7I4CPUACABAYAIQIAQAgohJBAAIAAElEQAgAwIBEARAIAAQAjQEIACJAEFgBIGAQACoGhYARRBKBIQYHBUcogQFSLRQTwAA.YAAAAAAAA">>
            , <<"CO42mdyO42mdyAGABCENA1CsAP_AAH_AAAYgGTpR_TpVbWFCyXZ9dtsAKIgXVASWA-QCAASAI2ABgAKQMBwCgmAQtASgBgACAQAAoBJBAAIEDAAESQAAwAAAAACAAAAEgAAIIAAAgBEAAAAYAAgKAIAABACIgAAQEAAAi0AIAiZgCBgkCKABwAHgAqABoADkAH4ATwArABZAC6AF8ANoAhABYgDUAH7AQcBCACIgEWAI4AWIAuYBdYDAAMCAYoAzIBrwDeAHUARAAlYBRICuwF9AMEAMGQCQAVABMAC4AKQAagA4gDeAKbAXmIgGgAqACsAFwAQwApABqADiAQ2Ai8BOwChwFIgMnEgAQAHBIE4ACwAKgAZAA4AB4AEAAIgAVAA8ACIAEyAKoArABYAC4AG8">>
            , <<"CO5ePVSO5ePVSAHABBENA2CgAP_AAE_AAAAAGetf_X_fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KuR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGH9vn8XTuZCY70_sf__z_3-_-___67b-IGeEEmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIwIgQY">>
            , <<"CO4B2zTO5UqyCADABBITA2CsAP_AAH_AAAAAGekB_X_fb2vj-_599_t0eY1f9_63v-wzjheNs-8NyZ_X_L4Wv2MyvB36pq4KuR4ku3bBAQFsHOncTQmRwIlVqTLsbk2Mr7NKJ7LEmlsbe2dYGHtPn8XT_ZKZ70_v___b_3______777-YGeEAmGpfAQJCWMBJNmlUKIEIVxIVAOACihGFo0sNCRwU7K4CPUECABAagIw">>
            , <<"CO5lNxtO5lNxtAKAMASVA3CsAP_AAH_AACQgGkNd_X_fb2vj-_5999t0e">>
            , <<"CO5IHMzO5IHOHB7DrBITA1CsAP_AAAAAAAAAGatf_X9fb2vj-_5999t0eY1f9_63v-wzjgeNs-8NyZ_X_L4Xr2MyvB36pq4KmR4Eu3LBAQdlHOHcTQmQwIkVqTLsbk2Mq7NKJ7LEilMbM2dYGG9vn8XTuZCY70_sf__z_3-_-___67bgZeQSYal8BAkJYwEk2aVQogQhXEhUA4AKKEYWjSw0JHBTsrgI9QQIAEBqAjAiBBiCjFkEAAAAASURACQDAgEQBEAgABACtAQgAIkAQWAEgYBAAKAaFgBFEEoEhBkcFRyiBAVItFBPNGAUChbAAEAAOAAmABgAGwAPABAACwAGAANAAfABDACQAJQAUgAvABmADWAHIAdAA9AB-AEEAIoASAAnQBZAFqALoAvgBhgDIAMoAaAA2ABuADkAHyAPwBBgCFAEVAIwAjYBHgEiAJuAToBRQCnAKgAVwAswBcgC-gGAAYQAx4BmgGcANOAa4BsADaAHUAO4AeEA8wD0AH0AP4AgEBBgEHAISAQ6AiACJgEVAIuARkAjoBIQCSwEvATCAmwCbwE7AT8AosBSAFJAKiAWYAtoBcAC6gF3AL1AXwBfYDAAMCAYMAyQBmgDOwGfAaAA0UBpgGnANWAa0A18BsgGzANuAb8A4QBywDpAHbAO-AeQA8wB6wD3wH1AfYA_MB_wIAgQIBAsCBwIJAQZAg8CEAEJwIXAhiBD4EQgIjgRKBEwCKQEWAIxARrAjgCOYEegR9Ak4CTwEqQJWAlcBLICXwEwgJkgTMBM8CaQJqATbAnACcgE6AJ3gT8BP8ChQKGAUQAoqBRgFGgKQAUmApYBTACnAFQQKiAqSBVQFVwKtAq6BWQFZgK5AV2Ar-BYQFhwLHAsgBZQCzIFngWhAtIC1QFrwLbAt8BcIC44FygXPAukC6gF6wL3AvqBfgF-wL_AwGBgYGCgMHgYUBhgDDoGIAYjAxQDF4GNAY2Ax8BkIDIwGSwMoAykBlcDLwMxAZmEhjQABAAIAAkABgAHgASABUADAANgAeACAAEoALAAwABoAD4AIYASABLACcAKYAWABaAC-AGQAZgA1gByAHYAPQAfwBBAEKAIoAkgBOAChAFIAU4AsgC3AF0AX4AwgDFAGQAZQA0ABsADcAHIAPkAfgCDAELAIoAjYBHgEiAJUATcAnQCigFOAVEArQCuAFnALgAuQBfQDAAMIAY8AzQDOAGiANMAasA1wDYAG0AOCAcYByQDqAOsAdwA8IB5AHpAPkA-gB_AEAgIMAhIBDoCIAImARUAi4BGQCOgEhgJKAkwBK4CXgJhATYBN4CdAJ-AUWApACkwFQAVEArMBXgFfALMAW0AuEBdQF3AL1AXwBfYDAAMCAYMAyQBmADNQGcAZ2Az4DQAGigNMA04BqwDWgGvgNkA2cBtgG3gN-A4ABwgDjgHLAOcAdIA7YB3wDxAHkAPNAeoB6wD2gHvgPqA-wB-QD9gH9gP-BAECBAIFgQOBBICDIEHgQhAhICE4ELgQxAh8CIQERwIlAiYBFICLAEYgI1gRwBHcCPQI-ASCAkMBJcCTgJPASiAlSBKwErwJZAlqBLwEvgJhATJAmYCZ4E0gTUAm2BOAE5AJ0ATvAn4Cf4FCAUNAogCioFGAUbAo8CkIFJAUnApYCmgFOAKggVEBUgCpoFVAVXAq0Cr4FZAVmArkBXcCvgK_gWEBYkCxwLKAWZAs8C1QFrwLbAt-BcIFxwLlAueBdIF2ALugXiBeUC9AL1gXuBfUC_AMBgYGBgsDBwMIgYUBhgDDoGIAYlAxQDF4GMgY3Ax4DHwGQgMjAZLAygDKQGVwMvAzEBmYaGMAAEAAkABgAHAATAAsAEAAJAAUgAsADAAGgAPwAhACKAEgASwAnACkAFgALwAZgA1gByAHUAPAA9AB_AEEAQoAiACSAEyAJwAngBUgCwALcAXQBfgDCAMUAZABlADQAGyANwA3wByAHOAO4A8AB8gD8AQYAhYBEgEVAIwAjYBHgEiAJuAToBRAClgFOAVEArQCuAFmALkAX0AwADCAGPAM0AzgBpgDVgGuAbAA2gBwADjAHPAOoA6wB3ADwgHkAekA-QD6AH8AQCAgwCDgEJAIdARABEwCKgEXAIyAR0AkMBJQEmAJXAS0BMICbAJxAToBPwCiwFIAUkAqIBWYCvAK-AWYAtoBcIC6gLuAXqAvgC_QGAAYEAwYBkgDNQGcAZ2Az4DQAGigNMA04BqwDWgGvgNkA2cBtgG3gN-A4ABwgDjwHKAcsA5wB0gDtgHfAPEAeQA80B6gHrAPfAfUB9gD8gH7gP-BAECBAIFgQOBBICDIEHgQhAhICE4ELgQxAh8CIQERwIlAiYBFICLAEYgI1gRwBHUCPQI-ASCAkMBJcCTgJPASiAlSBKwErwJZAlqBLwEvgJhATJAmYCZ4E0gTUAm2BOAE5AJ0ATvAn4Cf4FCgUMAogBRUCjAKNAUhApICkwFLAKYgU2BTgCoIFRAVJAqoCq4FWgVdArICswFcgK7AV_AsICxYFjgWQAsoBZkCzwLVAWvAtsC34FwgXHAuUC7AF3ALxgXoBesC9wL6gX4BfsC_wMBgYGBgoDB4GFAYYAw6BiAGJQMUAxeBjIGNwMeAx-BkIGSwMoAykBlcDLwMxAZmIhigABAAJAAYABwAEwALABAACQAFIALAAwABoAD8AIQAigBIAEsAJwApABYAC8AGYANYAcgB1ADwAP4AggCFAEQASQAmQBOAFCALAAtwBdAF-AMIAxQBkAGUANAAbIA3ADfAHIAcwA7gB8gD8AQYAhYBEgEVAIwAjYBHgEiAJuAToBRAClgFOAVEArQCuAFmALkAX0AwADCAGPAM0AzgBpgDVgGuAbAA2gBwADjAHPAOoA6wB3ADwgHkAekA-QD6AH8AQCAgwCDgEJAIdARABEwCKgEXAIyAR0AkMBJQEmAJWAS2Al4CYQE2ATeAnQCfgFFgKQApMBUAFRAKzAV4BXwCzAFtALhAXUBdwC9QF8AX6AwADAgGDAMkAZqAzgDOwGfAaAA0UBpgGoANWAa0A18BsgGzgNsA28BvwHAAOEAceA5QDlgHOAOkAdsA74B4gDyAHmgPUA9YB74D6gPsAfkA_cB_wIAgQIBAsCBwIJAQZAg8CEIEJAQnAhcCGIEPgRCAiOBEoETAIpARYAjEBGsCOAI7gR6BHwCQQEhgJLgScBJ4CUQEqQJWAleBLIEtQJeAl8BMICZIEzATPAmkCagE2wJwAnIBOgCd4E_AT_AoUChgFEAKKgUYBRoCkIFJAUmApYBTECmwKcAVBAqICpIFVAVXAq0CroFZAVmArkBXYCv4FhAWLAscCyAFlALMgWeBaoC14FtgW_AuEC44FygXYAu4BeMC9AL1gXuBfUC_AL9gX-BgMDAwMFAYPAwoDDAGHQMQAxKBigGLwMZAxuBjwGPwMhAyWBlAGUgMrgZeBmIDMxUMMAAgABwAEwAMAA2AB4AIAAWAAwABoAD8AIQAigBIAEoAKQAWAAvABmADWAHIAdAA9AB_AEEAQgAigBIACdAFkAWoAugC_AGEAYoAyADMAGgANgAbgA5AB4AD5AH4AgwBCgCKgEYARsAjwCRAEyAJuAToBRQCnAKiAVoBXACzAFyAL6AYABhADHAGVAM0AzgBpgDVgGuAbAA2gBwQDjAOQAdQA7gB4QDzAPSAfIB9AD-AIBAQYBBwCEgEOgIgAiYBFQCLgEZAI6ASGAkoCTAErgJaAmEBNgE3gJ2An4BRYCkAKSAVGArwCvgFmALaAXCAuoC7gF6gL4Av0BgAGBAMGAZIAzUBnAGdgM-A0ABooDTANOAasA1oBr4DZANmAbcA34BwgDlgHOAOkAdsA74B4gDyAHmAPWAe-A-oD7AH5AP3Af8CAIECAQLAgcCCQEGQIPAhCBCQEJwIXAhiBD4EQgIjgRKBEwCKQEWAIxARrAjgCO4EegR8AkOBJwEngJRASpAlYCVwEswJeAl8BMICZIEzATPAmkCagE2wJwAnIBOgCd4E_AT_AoUChgFEAKKgUYBRoCkAFJgKWgUwBTICnAFQQKiAqSBVQFVwKtAq6BWQFZgK5AV2Ar-BYQFiwLHAsgBZQCzIFngWqAteBbYFvgLhAXHAuUC54F0gXWAu6BegF6wL3AvqBfgF-wL_AwGBgYGCgMHgYUBhgDDoGIAYjAxQDF4GNAY3Ax4DHwGQgMjAZLAygDKQGVwMvAzGBmYGaDIYoABAADgAJgAYABsADwAQAAsABgADQAH4AQgBFACQAJQAUgAsABeADMAGsAOQA6AB6AD-AIIAhABFACQAE6ALIAtQBdAF-AMIAxQBkAGYANAAbAA3AByAD5AH4AgwBCgCKgEYARsAjwCRAEyAJuAToBRQCnAKiAVoBXACzAFyAL6AYABhADHAGVAM0AzgBpgDVgGuAbAA2gBwQDjAOQAdQA7gB4QDzAPQAfQA_gCAQEGAQcAhIBDoCIAImARUAi4BGQCOgEhAJKASsAlsBLwEwgJsAm8BOwE_AKLAUgBSQCowFeAV8AswBbQC4QF1AXcAvUBfAF-gMAAwIBgwDJAGagM4AzsBnwGgANFAaYBpwDVgGtANfAbIBswDbgG_AOEAcsA5wB0gDtgHfAPEAeQA8wB6wD3wH1AfYA_IB-4D_gQBAgQCBYEDgQSAgyBB4EIQISAhOBC4EMQIfAiEBEcCJQImARSAiwBGICNYEcAR3Aj0CPgEggJDgScBJ4CUQEqQJWAlcBLMCXgJfATCAmSBMwEzwJpAmoBNsCcAJyAToAneBPwE_wKFAoYBRACioFGAUaApABSYCloFMAUyApwBUECogKkgVUBVcCrQKugVkBWYCuQFdgK_gWEBYkCxwLIAWUAsyBZ4FoQLSAtUBa8C2wLfAXCAuOBcoFzwLpAusBd0C9AL1gXuBfUC_AL9gX-BgMDAwMFAYPAwoDDAGHQMQAxGBigGLwMaAxuBjwGPgMhAZGAyWBlAGUgMrgZeBmIDMx0MQAAIABIADAAPAAkACoAGAAbAA8AEAAJAAWAAwABoAD4AIYASABLACcAKYAWABaAC-AGQAZgA1gByAHQAPQAfwBBAEKAIoAkQBNAE4AKAAUoAsgC3AF0AXwAwwBkAGUANAAbAA3AByAD5AH4AgwBCwCKAI2AR4BIgCTAE3AJ0AooBTgFRAK0AroBZAFnALgAuQBfQDAAMIAY8AzQDOAGmANWAa4BsADagHGAckA6gDrAHdAPAA9IB8gH0AP4AgEBBgEHAISAQ6AiACJgEVAIuARkAjoBIYCSgJMASuAloCYQE2ATiAnQCfgFFgKQApIBUQCswFeAV8AswBbQC4QF1AXcAvUBfAF9gMAAwIBgwDJQGYAZqAzgDOwGfAaAA0UBpgGnANWAa0A18BsgGzgNsA28BvwHAAOEAcsA5wB0gDtgHfAPEAeQA80B6gHrAPaAe-A-oD7AH5gP2A_sB_wIAgQIBAsCBwIJAQZAg8CEIEJAQnAhcCGIEPgRCAiOBEoETAIpARYAjEBGsCOAI7gR6BHwCQwEkAJLgScBJ4CUQEqQJWAleBLIEtQJeAl8BMICZIEzATPAmkCagE2wJwAnIBOgCd4E_AT_AoQChgFEAKKgUYBRsCjwKQgUkBScClgKZAU4AqCBUQFSQKqAquBVoFXwKyArMBXICu4FfAV_AsICxIFjgWUAsyBZ4FqgLXgW2Bb4C4QFxwLlAueBdIF2ALuAXjAvQC-oF-AX7Av8DAYGBgYKAweBhQGGAMOgYgBiMDEwMXgYyBjoDH4GQgZGAyWBlAGUgMrAZbAy8DMQGZgM1IQwgAAgAE">>
    ],

    Maybe = lists:map(fun(X) -> consent_string:parse_b64(X) end, InvalidTCFEncoding),
    Uniq = lists:usort(Maybe),

    ?assertEqual([{error, invalid_consent_string}], Uniq).
